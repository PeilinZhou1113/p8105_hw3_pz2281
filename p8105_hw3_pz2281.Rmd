---
title: "p8105_hw3_pz2281"
author: "Peilin Zhou"
output: github_document
---

```{r}
library(tidyverse)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 8,
  fig.asp = 1,
  out.width = "100%" #shrunk down the size 
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1
read in instacart data

```{r}
library(p8105.datasets)
data("instacart")
instacart
```

The instacart dataset contains `r nrow(instacart)` observations with `r ncol(instacart)` variables. Each row represents a product from an order. The data contains customer information with unique user_id as a variable and there are `r length(unique(instacart$user_id))` unique customers. There are total of `r length(unique(instacart$department))` departments and `r length(unique(instacart$aisles))` aisles. The products from each order_id are ordered by the add_to_cart_order from the customer.

```{r}
aisle_freq = instacart %>% 
  group_by(aisle) %>% 
  summarize(
    n_obs = n()
  )
most_ord_aisle = aisle_freq %>% 
  slice_max(n_obs)
```
There are `r length(unique(instacart$aisle))` aisles and the aisle that most items are ordered from is `r most_ord_aisle`, which makes sense since people often order vegetables online from instacart, amazon fresh etc.

```{r}
aisle_freq %>% 
  filter(n_obs > 10000) %>% 
  arrange(n_obs) %>% 
  mutate(aisle = forcats::fct_inorder(aisle)) %>% 
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_col(alpha = 0.8) +
  labs(
    title = "Number of Items Ordered from Each Aisle",
    x = "Aisle Names",
    y = "Number of Items Ordered"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


```{r}
bake_ingr_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "baking ingredients") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4) %>% 
  arrange(order_rank)
  
dog_food_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "dog food care") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4) %>% 
  arrange(order_rank)

pack_vegfru_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "packaged vegetables fruits") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4) %>% 
  arrange(order_rank)
```


```{r}
order_table = bind_rows(bake_ingr_order, dog_food_order, pack_vegfru_order) %>%   relocate(order_rank, .before = n)
order_table
```

Now move to get tables for pink lady apple and coffee ice cream

```{r}
apple_mean_hour = instacart %>% 
  filter(product_name == "Pink Lady Apples") %>% 
  group_by(order_dow) %>% 
  summarize(
    mean_hour_day = mean(order_hour_of_day)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_day
  ) %>% 
  mutate(item_name = "Pink Lady Apple") %>% 
  relocate(item_name)

cof_ice_mean_hour = instacart %>% 
  filter(product_name == "Coffee Ice Cream") %>% 
  group_by(order_dow) %>% 
  summarize(
    mean_hour_day = mean(order_hour_of_day)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_day
  ) %>% 
  mutate(item_name = "Coffee Ice Cream") %>% 
  relocate(item_name)

table_mean_hour_day = bind_rows(apple_mean_hour, cof_ice_mean_hour) %>% 
  knitr::kable("simple")
table_mean_hour_day
```

## Problem 2
load the brfss data first

```{r}
data("brfss_smart2010")
```

```{r}
brfss_health_clean = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  rename(state = locationabbr, location_state = locationdesc, resp_id = respid) %>% 
  mutate(resp_id = gsub("RESP", "", resp_id)) %>% 
  filter(topic == "Overall Health") %>% 
  mutate(response = factor(response, c("Poor", "Fair", "Good", "Very good", "Excellent")))
#since the responses for the "overall health" question were only in form of poor, fair, good, very good, to excellent, we don't need to do another filter operation.
```

Find states that were observed at 7 or more locations for 2002 and 2010.

```{r}
brfss_health_clean = brfss_health_clean %>% 
  mutate(year = as.character(year))

brfss_health_clean %>% 
  filter(year == "2002") %>% 
  group_by(state) %>% 
  summarise(
    n_loc = n_distinct(location_state)
  ) %>% 
  filter(n_loc >= 7)
```
There were 6 statesthat were observed in more than 7 locations for year 2002. They were Connecticut, Florida, Massachusetts, North Carolina, New Jersey, and Pennsylvania.

```{r}
brfss_health_clean %>% 
  filter(year == "2010") %>% 
  group_by(state) %>% 
  summarise(
    n_loc = n_distinct(location_state)
  ) %>% 
  filter(n_loc >= 7)
```
There are 14 states in 2010 which were observed in more than 7 locations. It was 8 states more than that in 2002. More health data were collected in different locations for health assessment.


```{r}
brfss_health_clean %>% 
  filter(response == "Excellent") %>% 
  group_by(year, state) %>% 
  summarize(
    mean_data_value = mean(data_value)
  ) %>% 
  ggplot(aes(x = year, y = mean_data_value)) +
  geom_line(aes(group = state)) +
  labs(
    title = "Spaghetti Plot for Average Data Value for Each State across Years"
  )
```

Making plots for the distribution of data_value in 2006 and 2010.

```{r}
plot_2010 = brfss_health_clean %>% 
  filter(year == "2010" & state == "NY") %>% 
  group_by(response, location_state) %>% 
  summarize(
    mean_data_val = mean(data_value)
  ) %>% 
  ggplot(aes(x = response, y = mean_data_val, color = location_state)) +
  geom_line(aes(group = location_state)) +
  labs(
    title = "Average Data Value Based on Response Level for Locations in NY state for 2010"
  )
#  geom_text(data = filter(response == last(response)),
#              aes(label = location_state),
#              hjust = 0, nudge_x = 0.1)
```


```{r}
plot_2006 = brfss_health_clean %>% 
  filter(year == "2006" & state == "NY") %>% 
  group_by(response, location_state) %>% 
  summarize(
    mean_data_val = mean(data_value)
  ) %>% 
  ggplot(aes(x = response, y = mean_data_val, color = location_state)) +
  geom_line(aes(group = location_state)) +
  labs(
    title = "Average Data Value Based on Response Level for Locations in NY state for 2006"
  )

plot_2006 / plot_2010
```

##Problem 3
load csv data

```{r}
accel_df = read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(day_type = ifelse(day %in% c("Saturday", "Sunday"), "weekend", "weekday")) %>% 
  mutate(day_type = factor(day_type))
```










