---
title: "p8105_hw3_pz2281"
author: "Peilin Zhou"
output: github_document
---

```{r}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%" #shrunk down the size 
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1
read in instacart data

```{r}
library(p8105.datasets)
data("instacart")
instacart
```

The instacart dataset contains `r nrow(instacart)` observations with `r ncol(instacart)` variables. Each row represents a product from an order. The data contains customer information with unique user_id as a variable and there are `r length(unique(instacart$user_id))` unique customers. There are total of `r length(unique(instacart$department))` departments and `r length(unique(instacart$aisles))` aisles. The products from each order_id are ordered by the add_to_cart_order from the customer.

```{r}
aisle_freq = instacart %>% 
  group_by(aisle) %>% 
  summarize(
    n_obs = n()
  )
most_ord_aisle = aisle_freq %>% 
  slice_max(n_obs)
```
There are `r length(unique(instacart$aisles))` aisles and the aisle that most items are ordered from is `r most_ord_aisle`, which makes sense since people often order vegetables online from instacart, amazon fresh etc.

```{r}
aisle_freq %>% 
  filter(n_obs > 10000) %>% 
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_col() +
  labs(
    title = "Number of Items Ordered from Each Aisle",
    x = "Aisle Names",
    y = "number of Items Ordered"
  )
```

```{r}
bake_ing_order = 
  instacart %>% 
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>% 
  pivot_wider(
    names_from = aisle,
    values_from = product_name
  ) %>% 
  janitor::clean_names() %>% 
  select(baking_ingredients) %>% 
  drop_na() %>% 
  count(baking_ingredients) %>% 
  mutate(order_rank = min_rank(desc(n)))
# %>% 
#  filter(order_rank < 4)
```

```{r}
bake_ingr_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "baking ingredients") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4)
  
dog_food_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "dog food care") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4)

pack_vegfru_order = instacart %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  filter(aisle == "packaged vegetables fruits") %>% 
  mutate(order_rank = min_rank(desc(n))) %>% 
  filter(min_rank(desc(n)) < 4)
```


```{r}
order_table = bind_rows(bake_ingr_order, dog_food_order, pack_vegfru_order)
```







